<script type="text/javascript">


var series = new Array() ;
var maxY = 0 ;
var startDate ;
var SiteID = 9 ; // need to be initialized from database......
var json_raw ;
var str = "";
var i = 0 ;


	$(document).ready(function(){ 

		json_get() ;

	});

	function select_series(site_id) {
		$('#test').html('Selected Series:' + site_id)
		SiteID = site_id ;
		json_get() ;	
	}



	function json_get() {
		$.getJSON("/time_logs/data.json",
		{ site_id:SiteID },
		function(json_raw){
			series = [[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]] ;
			for (i=0;i<=9;i++)
				{
					series[i][0] = new Date (json_raw[i].checked ) ;
					series[i][1] = json_raw[i].delay ;
				}
			show_get(series);
		});
	}

	function show_get(series) {
				
				maxY = 0.05 ;
				$.jqplot('chartdiv',  [series],
				{ title:'Response Time for Site# ' + SiteID,
				  axes:{ yaxis: { min: 0, max: maxY },
				 		 xaxis: { renderer:$.jqplot.DateAxisRenderer,
		//		         tickOptions:{formatString:'%m/%d/%y - %I:%M:%S'},
				         tickOptions:{formatString:'%H:%M:%S'},
		//		         min: startDate ,
						 numberTicks: 10 ,
		//		         tickInterval:'2 hours'
				           },
					   },
					grid: {
			            drawBorder: true, 
			            drawGridlines: true,
			            background: '#ffffff',
			            shadow:true
			        },
				  series:[{color:'#5FAB78'}]
				}
						).replot();							
	}

	</script>
	
    <div class="container">

      <div class="content">
        <div class="page-header">
          <h1>Talon <small>keeping an eye on critical information</small></h1>
        </div>
        <div class="row">
          <div class="span10">
            <h3>Sites under watch</h3>
			
			<div id="chartdiv" ></div>

          </div>
          <div class="span4">
            <h3>Status</h3>
			<div id="test" >Test</div>
			
			<table class="zebra-striped">
			  <tr>
			    <th>Url</th>
			    <th>Delay</th>
			  </tr>

			<% @sites.each do |site| %>
			  <tr>
			    <td><a href="#"onclick="select_series(<%= site.id %>)"><%= truncate(site.url, :length => 10) %></a></td>
			    <td><%= number_with_precision(site.delay, :precision => 5 ) %></td>
			  </tr>
			<% end %>
			</table>


			<br>
			<a href="#" onclick="json_get()">Test Get</a>

          </div>
        </div>
      </div>

      <footer>
        <p>&copy; Company 2011</p>
      </footer>

    </div> <!-- /container -->

  </body>
</html>